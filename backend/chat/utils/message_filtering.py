import re
from typing import Optional

# ê¸ˆì¹™ì–´ ë° ë¯¼ê°ì •ë³´ íŒ¨í„´ ì •ì˜
FILTER_PATTERNS = {
    "ìš•ì„¤": [
        r'ã……+ã…‚|ã…†ã…‚|ì”¨+ë°œ|ì‹œë°œ|c[i1]bal|tlqkf',
        r'ã…‚ã……|ë³ì‹ |ë³‘ì‹ |ë¸…ì‹ |qkfxl|wls',
        r'ã„±ã……ã„²|ê°œã……ã…‹|ê°œìƒ‰ê¸°|ê°œìƒˆë¼|ê°œì‰ë¦¬|gaesaekki|g[a4]esa[e3]kki',
        r'ì§€ë„|ã…ˆã„¹|zlral|gë„',
        r'ì¡´ë‚˜|ã…ˆã„´|ì¢†ë‚˜|ì¡°ë‚¸|ì«€ë‚˜',
        r'ì¢†[ê°€-í£]*|ì¢‡[ê°€-í£]*|xê¹Œ|ì¢†ê°™|ì¢†ã„±ã…',
        r'fuck|f[\W_]*u[\W_]*c[\W_]*k|fck|f\*ck|fcuk',
        r'sh[i1]t|s#it|s\*it',
        r'b[i!*]tch|bi7ch|b\*tch',
        r'a[s$]{2}hole|ass\s?h0le|a\$hole',
        r'motherf[\W_]*\*?ker|mofo|bastard|slut|pussy|cunt|fag|retard',
        r'n[i1!]{1,2}gg[a@]?',
        r'êº¼ì ¸|ì£½ì–´|ë’¤ì ¸|ë””ì ¸|ì£½ì„ë˜|ì—¿\s?ë¨¹|ê°œì†Œë¦¬|ë¯¸ì¹œX|ã…ã…Šã„´|ã…„',
        r'ëŠ[ê¸ˆê¸‰]ë§ˆ|ë‹ˆì• ë¯¸|ì—„ë§ˆì¢†|ì—„ë§ˆX',
        r'[ê°€-í£]{2,}(ì¶©|ì¸™)',
    ],
    "URL": [
        r'(h[\W_]*t[\W_]*t[\W_]*p[s]?[\W_]*:\/\/)|(www[\W_]*\.[^\s]+)',
        r'\S+\.(com|net|kr|org|co|shop|tv)',
        r'[a-zA-Z0-9\-]{2,}\.[a-z]{2,}(/\S*)?',
        r'dot\s?(com|net|kr)',
    ],
    "ì´ë©”ì¼ì£¼ì†Œ": [
        r'[0-9A-Za-z._%+-]+\s*(\(at\)|\[at\]|@|ï¼ |ê³¨ë±…ì´)\s*[0-9A-Za-z.-]+\.[A-Za-z]{2,}',
        r'[a-zA-Z0-9_.+-]+\s*at\s*[a-zA-Z0-9-]+\s*dot\s*[a-zA-Z0-9-.]+',
    ],
    "ì£¼ë¯¼ë²ˆí˜¸": [r'\d{6}[-\s]?\d{7}'],
    "ì¹´ë“œë²ˆí˜¸": [
        r'\b(?:\d[ -]*?){13,16}\b',
        r'ì¹´ë“œ\s?ë²ˆí˜¸\s?:?\s?\d{4}[ -]?\d{4}[ -]?\d{4}[ -]?\d{4}',
    ],
    "ê³„ì¢Œë²ˆí˜¸": [
        r'\d{2,4}[-\s]?\d{3,6}[-\s]?\d{4,6}',
        r'ê³„ì¢Œ\s?ë²ˆí˜¸\s?:?\s?\d{3,4}[ -]?\d{3,4}[ -]?\d{4}',
    ],
    "ì „í™”ë²ˆí˜¸": [
        r'01[016789][-]?\d{3,4}[-]?\d{4}',
        r'0\d{1,2}[-]?\d{3,4}[-]?\d{4}',
        r'ê³µ\s?ì¼\s?ê³µ|ê³µ\s?ì´\s?ì˜¤|ì˜\s?ì¼\s?ì˜|0IO|zero one zero',
    ],
    "ì£¼ì†Œ": [
        r'(ì„œìš¸|ë¶€ì‚°|ëŒ€êµ¬|ì¸ì²œ|ê´‘ì£¼|ëŒ€ì „|ìš¸ì‚°|ì„¸ì¢…|ê²½ê¸°|ê°•ì›|ì¶©ë¶|ì¶©ë‚¨|ì „ë¶|ì „ë‚¨|ê²½ë¶|ê²½ë‚¨|ì œì£¼).{0,10}(ì‹œ|ë„|êµ¬|êµ°)',
        r'\d{1,5}\s?(ë²ˆì§€|ë™|í˜¸|ë¡œ|ê¸¸)',
    ],
    "ì‹ ìš©ì •ë³´": [
        r'cvv\s?\d{3}',
        r'exp\s?\d{2}/\d{2}',
        r'ë§Œë£Œì¼\s?:?\s?\d{2}/\d{2}',
    ],
    "ê°œì¸ì •ë³´í‚¤ì›Œë“œ": [
        r'ë‚´\s?(ì´ë¦„|ì „í™”|ì£¼ì†Œ|ì£¼ë¯¼ë²ˆí˜¸|ê³„ì¢Œ|ì¹´ë“œ)',
        r'ìš°ë¦¬\s?ì§‘|ì§‘ì£¼ì†Œ|ì§‘\s?ì „í™”|ì—°ë½ì²˜',
    ],
    "SNS ID": [
        r'(ì¹´ì¹´ì˜¤í†¡|ì¹´í†¡|kakao)\s?(ì•„ì´ë””|ID)?\s?:?\s?\S+',
        r'(ì¸ìŠ¤íƒ€|instagram|insta)\s?(ì•„ì´ë””|ID)?\s?:?\s?\S+',
        r'(ë””ìŠ¤ì½”ë“œ|ë””ì½”|discord)\s?(ì•„ì´ë””|ID)?\s?:?\s?\S+',
        r'(í…”ë ˆê·¸ë¨|í…”ë ˆ|telegram)\s?(ì•„ì´ë””|ID)?\s?:?\s?\S+',
        r'(í˜ì´ìŠ¤ë¶|í˜ë¶|facebook|fb)\s?(ì•„ì´ë””|ID)?\s?:?\s?\S+',
        r'@[\w.]+\s?#\d{4}',  # ì´ë©”ì¼ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡ "#" í¬í•¨ëœ Discord í˜•ì‹ ë“±
    ],
}

# í•„í„°ë§ ì°¨ë‹¨ ë©”ì‹œì§€ ì •ì˜
REASON_MESSAGES = {
    "ìš•ì„¤": "âš ï¸ ë¶€ë“œëŸ¬ìš´ ëŒ€í™”ë¥¼ ìœ„í•´ ìš•ì„¤ì€ í”¼í•´ì£¼ì„¸ìš”.",
    "URL": "ğŸ”— ì™¸ë¶€ ë§í¬ëŠ” ì•ˆì „ì„ ìœ„í•´ ì „ì†¡í•  ìˆ˜ ì—†ì–´ìš”.",
    "ì´ë©”ì¼ì£¼ì†Œ": "ğŸ“§ ì´ë©”ì¼ ì£¼ì†ŒëŠ” ì´ê³³ì—ì„œ ê³µìœ í•  ìˆ˜ ì—†ì–´ìš”.",
    "ì£¼ë¯¼ë²ˆí˜¸": "ğŸ†” ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ì²˜ëŸ¼ ë³´ì´ëŠ” ìˆ«ìëŠ” ê³µìœ í•  ìˆ˜ ì—†ì–´ìš”.",
    "ì¹´ë“œë²ˆí˜¸": "ğŸ’³ ì¹´ë“œë²ˆí˜¸ëŠ” ì ˆëŒ€ ê³µìœ í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì£¼ì„¸ìš”.",
    "ê³„ì¢Œë²ˆí˜¸": "ğŸ¦ ê³„ì¢Œë²ˆí˜¸ëŠ” ê°œì¸ì •ë³´ì´ë¯€ë¡œ ì „ì†¡í•  ìˆ˜ ì—†ì–´ìš”.",
    "ì „í™”ë²ˆí˜¸": "ğŸ“ ì „í™”ë²ˆí˜¸ì²˜ëŸ¼ ë³´ì´ëŠ” ì •ë³´ëŠ” ê³µìœ í•  ìˆ˜ ì—†ì–´ìš”.",
    "ì£¼ì†Œ": "ğŸ  ì§‘ ì£¼ì†Œë‚˜ ìœ„ì¹˜ ì •ë³´ëŠ” ì•ˆì „ì„ ìœ„í•´ ê³µìœ í•˜ì§€ ë§ì•„ì£¼ì„¸ìš”.",
    "ì‹ ìš©ì •ë³´": "ğŸ” ì¹´ë“œ ë§Œë£Œì¼, CVV ê°™ì€ ì •ë³´ëŠ” ë³´ì•ˆì„ ìœ„í•´ ì°¨ë‹¨ë¼ìš”.",
    "ê°œì¸ì •ë³´í‚¤ì›Œë“œ": "ğŸ›¡ï¸ ê°œì¸ì •ë³´ë¡œ ì¶”ì •ë˜ëŠ” ë‚´ìš©ì€ ë³´í˜¸ë¥¼ ìœ„í•´ ì „ì†¡ì´ ì œí•œë¼ìš”.",
    "SNS ID": "ğŸ“± ì™¸ë¶€ ì±„íŒ…ì•± IDëŠ” ì´ê³³ì—ì„œ ê³µìœ í•  ìˆ˜ ì—†ì–´ìš”.",
    "ê¸°íƒ€": "â—ï¸ì´ ë¬¸ì¥ì€ ì¡°ê¸ˆ ìœ„í—˜í•  ìˆ˜ ìˆì–´ìš”. ë‹¤ë¥¸ ë§ë¡œ í‘œí˜„í•´ë³¼ê¹Œìš”?",
}


def detect_message_reason(message: str) -> Optional[str]:
    """
    ë©”ì‹œì§€ì—ì„œ í•„í„°ë§ ì‚¬ìœ ê°€ ìˆìœ¼ë©´ í•´ë‹¹ í‚¤ ë°˜í™˜, ì—†ìœ¼ë©´ None
    """
    for reason, patterns in FILTER_PATTERNS.items():
        for pattern in patterns:
            if re.search(pattern, message, re.IGNORECASE):
                return reason
    return None


def check_predefined_patterns(message: str) -> bool:
    """
    ë©”ì‹œì§€ê°€ ê¸ˆì¹™ì–´ ë˜ëŠ” ë¯¼ê° ì •ë³´ íŒ¨í„´ì— í•˜ë‚˜ë¼ë„ ê±¸ë¦¬ëŠ”ì§€ ì—¬ë¶€
    """
    return detect_message_reason(message) is not None
